{% extends 'base.html' %}
{% block content %}

<style>
  /* Main wrapper */
  .buy-wrapper {
      width: 80%;
      max-width: 900px;
      margin: 40px auto;
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  }

  /* PRODUCT SECTION LEFT */
  .product-section {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 25px;
  }

  .product-section img {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 10px;
      border: 1px solid #ddd;
  }

  .product-info h2 {
      margin-bottom: 6px;
      color: #222;
  }

  .product-info p {
      font-size: 18px;
      font-weight: 600;
      color: green;
      margin: 0;
  }

  /* Address items */
  .address-item {
      margin-bottom: 12px;
      padding: 12px;
      background: #f7f7f7;
      border-radius: 8px;
      border: 1px solid #ddd;
      transition: 0.3s ease;
  }

  .address-item:hover {
      background: #eee;
  }

  label {
      cursor: pointer;
      font-size: 15px;
  }

  /* New address form */
  #newAddressForm input,
  #newAddressForm textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
  }

  textarea {
      min-height: 70px;
      resize: none;
  }

  /* SMALL payment button */
  .add-btn {
      width: 200px;
      padding: 10px;
      border: none;
      margin: 10px auto;
      display: block;
      border-radius: 8px;
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: 0.3s ease;
  }

  .add-btn:hover {
      background-color: #0a6c0a !important;
  }
</style>


<div class="buy-wrapper">

<!-- PRODUCT LEFT SECTION -->
<div class="product-section">
    <img src="{{ product.image.url }}" alt="Product Image">

    <div class="product-info">
        <h2>{{ product.name }}</h2>
        <p>â‚¹{{ product.discount_price|default:product.price }}</p>
    </div>
</div>

<form method="post">
  {% csrf_token %}

  <h3>Select Address</h3>

  {% if addresses %}
    {% for addr in addresses %}
      <div class="address-item">
        <label>
          <input type="radio" name="selected_address" value="{{ addr.id }}" required>
          {{ addr.full_name }}, {{ addr.address_line }}, {{ addr.city }} - {{ addr.pincode }}
        </label>
      </div>
    {% endfor %}
  {% endif %}

  <div class="address-item">
    <label>
      <input type="radio" name="selected_address" value="new" required onclick="toggleNewAddress(true)">
      Add New Address
    </label>
  </div>

  <div id="newAddressForm" style="display:none;">
    <h4>Enter New Address</h4>
    <input type="text" name="full_name" placeholder="Full Name">
    <input type="text" name="phone" placeholder="Phone">
    <textarea name="address_line" placeholder="Address"></textarea>
    <input type="text" name="city" placeholder="City">
    <input type="text" name="state" placeholder="State">
    <input type="text" name="pincode" placeholder="Pincode">
  </div>

  <button type="submit" class="add-btn" style="background-color:green;">Proceed to Payment</button>
</form>

</div>

<script>
function toggleNewAddress(show) {
  document.getElementById('newAddressForm').style.display = show ? 'block' : 'none';
}

document.querySelectorAll('input[name="selected_address"]').forEach(radio => {
  radio.addEventListener('change', function() {
    toggleNewAddress(this.value === 'new');
  });
});
</script>

{% endblock %}
